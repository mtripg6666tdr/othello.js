!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.othello=e():t.othello=e()}(self,(function(){return(()=>{"use strict";var t={914:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.defaultGameConfig=void 0,e.defaultGameConfig={firstMove:"white"}},769:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;const r=n(914),s=n(607);e.Game=class{constructor(t){this._board=null,this._state={status:"ready"},this._config=null,this._listener=[],this._config=Object.assign(Object.assign({},t),r.defaultGameConfig),this._board=new s.OthelloBoardManager(this._config)}get white(){return this._board.getInfo("white")}get black(){return this._board.getInfo("black")}get state(){return this._state}set state(t){this._state=t}get board(){return this._board}put(t){const e=this._board.put(t);return this.emit(this._board.nextStone),e.winner&&this.emit("finish"),e}logBoard(){console.log("  ０１２３４５６７"),console.log("  ――――――――");for(let t=0;t<8;t++){const e=t+"|"+[...Array(8)].map(((e,n)=>{switch(this._board.getCell(n,t).type){case"black":return"●";case"white":return"○";case"none":return"　"}})).join("")+"|";console.log(e)}console.log("  ――――――――"),console.log("Next: "+("black"===this._board.nextStone?"●":"○")+this._board.nextStone),console.log("Turn count: "+this.board.putLog.length)}addListener(t){this._listener.push(t)}removeListener(t){const e=this._listener.findIndex((e=>e===t));return!!e&&(this._listener.splice(e,1),!0)}emit(t){this._listener.forEach((e=>e(t)))}}},607:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OthelloBoardManager=void 0;const r=n(158),s=n(464);e.OthelloBoardManager=class{constructor(t){this._config=t,this._data=null,this._log=[],this.init()}get putLog(){return this._log}init(){this._data=[...Array(8)].map(((t,e)=>[...Array(8)].map(((t,n)=>new r.CellStatus("none",e,n))))),this.setCell("black",{x:3,y:3},{x:4,y:4}).setCell("white",{x:3,y:4},{x:4,y:3})}getInfo(t){return new s.StoneStatus(this.sumCell((e=>e.type===t)))}get nextStone(){return"black"===this.getLastMover()?"white":"black"}get log(){return this._log}put(t,e=!1){if(this.log[this.log.length-1]&&this.log[this.log.length-1].winner){if(e)return!1;throw new Error("the game has already finished")}let n=null;const r=[];if("put"===t.type){const n=this.getCell(t.x,t.y);if(!e&&this.getLastMover()===t.current)throw new Error("two consecutive mover");if("none"!==n.type){if(e)return!1;throw new Error("the cell has already been put a stone on")}const s=this.getAroundCells(t.x,t.y);if(0===s.length){if(e)return!1;throw new Error("the cell surrounded by no stone")}if(0===s.filter((t=>t.type!==n.type)).length){if(e)return!1;throw new Error("the cell surrounded by no stone of the other type")}const l={row:!1,column:!1,plusdiagonal:!1,minusdiagonal:!1},o={row:null,column:null,plusdiagonal:null,minusdiagonal:null},i=o.row=this.getRow(t.y);l.row=this.replaceCells(t,t.x,i,"plus")||this.replaceCells(t,t.x,i,"minus");const a=o.column=this.getColumn(t.x);l.column=this.replaceCells(t,t.y,a,"plus")||this.replaceCells(t,t.y,a,"minus");const u=o.plusdiagonal=this.getPlusDiagonals(t);l.plusdiagonal=this.replaceCells(t,u.findIndex((e=>t.x===e.x)),u,"plus")||this.replaceCells(t,u.findIndex((e=>t.x===e.x)),u,"minus");const h=o.minusdiagonal=this.getMinusDiagnals(t);if(l.minusdiagonal=this.replaceCells(t,h.findIndex((e=>t.x===e.x)),h,"plus")||this.replaceCells(t,h.findIndex((e=>t.x===e.x)),h,"minus"),!(l.row||l.column||l.plusdiagonal||l.minusdiagonal)){if(e)return!1;throw new Error("no cell to turn")}e||(["row","column","plusdiagonal","minusdiagonal"].forEach((t=>{l[t]&&o[t].forEach((t=>{this.getCell(t.x,t.y)!==t&&(this._data[t.x][t.y]=t,r.push(t))}))})),this.setCell(t.current,t))}if(0===this.sumCell((t=>"none"===t.type))||!e&&this.getAbleToPut("black").length+this.getAbleToPut("white").length===0){const t=this.sumCell((t=>"white"===t.type)),e=this.sumCell((t=>"black"===t.type));n=t>e?"white":t===e?"draw":t<e?"black":null}const s=Object.assign(Object.assign({},t),{winner:n,modified:r});return e||this._log.push(s),s}reset(t){this.init(),t.forEach((t=>{"pass"===t.type?this.put({type:t.type,current:t.current}):this.put({type:t.type,current:t.current,x:t.x,y:t.y})}))}setCell(t,...e){return e.forEach((e=>{this._data[e.x][e.y]=new r.CellStatus(t,e.x,e.y)})),this}getCell(t,e){return Object.assign(new r.CellStatus,this._data[t][e])}getAroundCells(t,e){const n=[];return[this._data[t-1],this._data[t],this._data[t+1]].filter((t=>Boolean(t))).forEach((t=>{n.push(...[t[e-1],t[e],t[e+1]].filter((t=>Boolean(t))))})),n}getAbleToPut(t){const e=[];for(let n=0;n<8;n++)for(let r=0;r<8;r++)this.put({type:"put",current:t,x:n,y:r},!0)&&e.push({x:n,y:r});return e}getColumn(t){return[...this._data[t]]}getRow(t){return[...Array(8)].map(((e,n)=>this._data[n][t]))}getPlusDiagonals(t){const e=t.x+t.y,n=[];for(let t=0;t<=7;t++){const r=this.getColumn(t);r&&n.push(r[e-t])}return n.filter((t=>Boolean(t)))}getMinusDiagnals(t){const e=t.x-t.y,n=[];for(let t=0;t<=7;t++){const r=this.getColumn(t);r&&n.push(r[t-e])}return n.filter((t=>Boolean(t)))}getLastMover(){return this._log.length>0?this._log[this._log.length-1].current:"black"===this._config.firstMove?"white":"black"}sumCell(t){let e=0;return this._data.forEach((n=>{n.forEach((n=>{t(n)&&e++}))})),e}replaceCells(t,e,n,s){if(n.length===e+1&&"plus"===s||0===e&&"minus"===s)return!1;if("plus"===s){let s=-1,l=-1;for(let r=e+1;r<n.length&&"none"!==n[r].type&&n[r].type!==t.current;r++)if(-1===s)s=r,l=r;else{if(l+1!==r)break;l=r}if(-1===s||!n[l+1]||n[l+1].type!==t.current)return!1;for(let e=s;e<=l;e++)n[e]=new r.CellStatus(t.current,n[e].x,n[e].y);return!0}{let s=-1,l=-1;for(let r=e-1;r>=0&&"none"!==n[r].type&&n[r].type!==t.current;r--)if(-1===s)s=r,l=r;else{if(l-1!==r)break;l=r}if(-1===s||!n[l-1]||n[l-1].type!==t.current)return!1;for(let e=s;e>=l;e--)n[e]=new r.CellStatus(t.current,n[e].x,n[e].y);return!0}}}},158:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CellStatus=void 0,e.CellStatus=class{constructor(t,e,n){this.type=t,this.x=e,this.y=n}}},464:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StoneStatus=void 0,e.StoneStatus=class{constructor(t){this.count=t}}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var l=e[r]={exports:{}};return t[r](l,l.exports,n),l.exports}var r={};return(()=>{var t=r;Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var e=n(769);Object.defineProperty(t,"Game",{enumerable:!0,get:function(){return e.Game}})})(),r})()}));